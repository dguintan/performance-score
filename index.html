<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>學生表現分數登記</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #e6f2ff; /* 淡藍色背景 */
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .header {
            text-align: center;
            padding: 10px 0;
            font-size: 24px;
            font-weight: bold;
            background-color: #4CAF50;
            color: white;
        }
        .top-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: auto;
        }
        .bottom-section {
            flex: 2;
            overflow: auto;
            position: relative;
        }
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .button {
            padding: 10px;
            cursor: pointer;
            border: none;
            color: white;
            flex: 1;
            min-width: 80px;
            text-align: center;
        }
        .gray-btn {
            background-color: #ccc;
        }
        .green-btn {
            background-color: #4CAF50;
        }
        .red-btn {
            background-color: #f44336;
        }
        .seat-btn {
            padding: 10px;
            border: 1px solid #ddd;
            cursor: pointer;
            flex: 1;
            min-width: 40px;
            text-align: center;
        }
        .seat-btn.gray-btn {
            background-color: #ccc;
        }
        .seat-btn.green-btn {
            background-color: #4CAF50;
            color: white;
        }
        .seat-btn.red-btn {
            background-color: #f44336;
            color: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .sticky-header th {
            position: sticky;
            top: 0;
            background-color: #f2f2f2;
            z-index: 1;
        }
        .download-btn {
            margin-left: 10px;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .date-display {
            margin-left: 10px;
            font-size: 14px;
            font-weight: bold;
        }
        .table-container {
            position: relative;
            overflow: auto;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 網頁標題 -->
        <div class="header">平時表現登記表</div>

        <!-- 上部分：操作區域 -->
        <div class="top-section">
            <div class="button-container" id="item-buttons">
                <!-- 20項目按鈕 -->
                <button class="button gray-btn" onclick="setCurrentItem(0)">尊師重道</button>
                <button class="button gray-btn" onclick="setCurrentItem(1)">體貼助人</button>
                <button class="button gray-btn" onclick="setCurrentItem(2)">慈悲護生</button>
                <button class="button gray-btn" onclick="setCurrentItem(3)">言行有禮</button>
                <button class="button gray-btn" onclick="setCurrentItem(4)">見賢思齊</button>
                <button class="button gray-btn" onclick="setCurrentItem(5)">內省改過</button>
                <button class="button gray-btn" onclick="setCurrentItem(6)">個人整潔</button>
                <button class="button gray-btn" onclick="setCurrentItem(7)">認真打掃</button>
                <button class="button gray-btn" onclick="setCurrentItem(8)">熱心服務</button>
                <button class="button gray-btn" onclick="setCurrentItem(9)">準時排隊</button>
                <button class="button gray-btn" onclick="setCurrentItem(10)">惜福愛物</button>
                <button class="button gray-btn" onclick="setCurrentItem(11)">舉手發言</button>
                <button class="button gray-btn" onclick="setCurrentItem(12)">課前準備</button>
                <button class="button gray-btn" onclick="setCurrentItem(13)">課堂發表</button>
                <button class="button gray-btn" onclick="setCurrentItem(14)">誠實</button>
                <button class="button gray-btn" onclick="setCurrentItem(15)">勇氣</button>
                <button class="button gray-btn" onclick="setCurrentItem(16)">負責</button>
                <button class="button gray-btn" onclick="setCurrentItem(17)">合作</button>
                <button class="button gray-btn" onclick="setCurrentItem(18)">其他1</button>
                <button class="button gray-btn" onclick="setCurrentItem(19)">其他2</button>
            </div>
            <div class="button-container">
                <!-- 35個座號按鈕 -->
                <div id="seat-buttons">
                    <!-- 按鈕生成 -->
                </div>
            </div>
        </div>
        
        <!-- 下部分：顯示區域 -->
        <div class="bottom-section">
            <div class="table-container">
                <table>
                    <thead class="sticky-header">
                        <tr>
                            <th>座號</th>
                            <!-- 頭部列顯示20項目 -->
                            <th colspan="20">
                                加扣分項目
                                <button class="download-btn" onclick="downloadExcel()">下載數據</button>
                                <span class="date-display" id="current-date"></span>
                            </th>
                            <th>總計</th>
                        </tr>
                        <tr>
                            <th>座號</th>
                            <!-- 顯示20項目標題 -->
                            <th>尊師重道</th>
                            <th>體貼助人</th>
                            <th>慈悲護生</th>
                            <th>言行有禮</th>
                            <th>見賢思齊</th>
                            <th>內省改過</th>
                            <th>個人整潔</th>
                            <th>認真打掃</th>
                            <th>熱心服務</th>
                            <th>準時排隊</th>
                            <th>惜福愛物</th>
                            <th>舉手發言</th>
                            <th>課前準備</th>
                            <th>課堂發表</th>
                            <th>誠實</th>
                            <th>勇氣</th>
                            <th>負責</th>
                            <th>合作</th>
                            <th>其他1</th>
                            <th>其他2</th>
                            <th>總計</th>
                        </tr>
                    </thead>
                    <tbody id="student-scores">
                        <!-- 用於顯示學生數據的行 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        const numStudents = 35;
        const numItems = 20;
        let currentItem = -1;
        const scores = Array.from({ length: numStudents }, () => Array(numItems).fill(null));
        const seatButtons = [];

        // 生成座號按鈕
        const seatButtonsContainer = document.getElementById('seat-buttons');
        for (let i = 1; i <= numStudents; i++) {
            const button = document.createElement('button');
            button.textContent = i;
            button.className = 'seat-btn gray-btn';
            button.onclick = () => updateScore(i, currentItem);
            seatButtons.push(button);
            seatButtonsContainer.appendChild(button);
        }

        function setCurrentItem(itemId) {
            const buttons = document.querySelectorAll('#item-buttons .button');
            const selectedButton = buttons[itemId];
            
            // 切換按鈕顏色：綠色 -> 紅色 -> 灰色
            if (selectedButton.classList.contains('gray-btn')) {
                selectedButton.className = 'button green-btn'; // 設置為綠色
                currentItem = itemId;
                updateSeatButtons('green-btn');
            } else if (selectedButton.classList.contains('green-btn')) {
                selectedButton.className = 'button red-btn'; // 設置為紅色
                currentItem = itemId;
                updateSeatButtons('red-btn');
            } else if (selectedButton.classList.contains('red-btn')) {
                selectedButton.className = 'button gray-btn'; // 設置為灰色
                currentItem = -1;
                updateSeatButtons('gray-btn');
            }
        }

        function updateSeatButtons(colorClass) {
            seatButtons.forEach(button => {
                if (colorClass === 'green-btn') {
                    button.className = 'seat-btn green-btn';
                } else if (colorClass === 'red-btn') {
                    button.className = 'seat-btn red-btn';
                } else {
                    button.className = 'seat-btn gray-btn';
                }
            });
        }

        function updateScore(studentId, itemId) {
            if (itemId === -1) return;

            const seatButton = seatButtons[studentId - 1];
            const currentItemClass = document.querySelectorAll('#item-buttons .button')[itemId].className;

            let change = 0;
            if (currentItemClass.includes('green-btn')) {
                change = 1;
                seatButton.className = 'seat-btn green-btn';
            } else if (currentItemClass.includes('red-btn')) {
                change = -1;
                seatButton.className = 'seat-btn red-btn';
            } else {
                return;
            }

            scores[studentId - 1][itemId] = (scores[studentId - 1][itemId] || 0) + change;
            updateSummary();
        }

        function updateSummary() {
            const studentScoresContainer = document.getElementById('student-scores');
            studentScoresContainer.innerHTML = '';

            for (let i = 1; i <= numStudents; i++) {
                const row = document.createElement('tr');
                const totalScore = scores[i - 1].reduce((sum, score) => sum + (score || 0), 0);
                row.innerHTML = `<td>${i}</td>${scores[i - 1].map(score => score !== null ? `<td>${score}</td>` : `<td></td>`).join('')}<td>${totalScore}</td>`;
                studentScoresContainer.appendChild(row);
            }
        }

        function downloadExcel() {
            const wb = XLSX.utils.book_new();
            const ws_data = [
                ["座號", "尊師重道", "體貼助人", "慈悲護生", "言行有禮", "見賢思齊", "內省改過", "個人整潔", "認真打掃", "熱心服務", "準時排隊", "惜福愛物", "舉手發言", "課前準備", "課堂發表", "誠實", "勇氣", "負責", "合作", "其他1", "其他2", "總計"]
            ];
            for (let i = 0; i < numStudents; i++) {
                const totalScore = scores[i].reduce((sum, score) => sum + (score || 0), 0);
                ws_data.push([i + 1, ...scores[i], totalScore]);
            }
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            XLSX.utils.book_append_sheet(wb, ws, "學生分數");

            const now = new Date();
            const dateStr = now.toLocaleString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }).replace(/\//g, '-').replace(/\s/g, '_').replace(/:/g, '');
            XLSX.writeFile(wb, `學生分數_${dateStr}.xlsx`);

            // 更新按鈕旁的日期時間
            document.getElementById('current-date').textContent = dateStr;
        }

        // 初始顯示
        updateSummary();
    </script>
</body>
</html>
